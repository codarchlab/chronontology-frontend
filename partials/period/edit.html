<div>
    <h3>Edit</h3>

    <div class="row">
        <h4>ID</h4>
        <form class="form-group">
            <input required type="text" class="form-control" ng-model="$ctrl.period.id" readonly>
        </form>
    </div>

    <div class="row">
        <h4>Type</h4>
        <form class="form-group">
            <div class="col-md-6" ng-repeat="type in $ctrl.validTypes">
                <label>
                    <input type="radio" ng-model="$ctrl.period.type" value="{{type}}">
                    {{type}}
                </label>
            </div>
        </form>
    </div>

    <div class="form-group">
        <h4>
            Period names
        </h4>

        <div class="row" ng-init="languageIndex = $index"
             ng-repeat="language in $ctrl.period.names track by $index">
            <p>
                <div class="col-md-2">
                    <div class="input-group">
                        <span class="input-group-btn">
                             <button class="btn btn-danger"
                                     ng-click="$ctrl.removeLanguage(language)"
                                     type="button">
                                 <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span>
                             </button>
                        </span>
                        <input type="text"
                               class="form-control"
                               ng-model="$ctrl.period.names[languageIndex]['lang']">
                    </div>
                </div>
                <div class="col-md-10">
                     <div ng-init="variantIndex = $index"
                          ng-repeat="name in $ctrl.period.names[languageIndex]['content'] track by $index">
                         <div class="input-group">
                             <input type="text"
                                    class="form-control"
                                    ng-model="$ctrl.period.names[languageIndex]['content'][variantIndex]">
                             <span class="input-group-btn">
                                 <button class="btn btn-danger"
                                         ng-click="$ctrl.removeName(language, name)"
                                         type="button">
                                     <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span>
                                 </button>
                            </span>
                         </div>
                     </div>
                     <div class="input-group">
                         <input type="text" class="form-control" id="name-input-{{language['lang']}}" placeholder="Add name...">
                         <span class="input-group-btn">
                             <button class="btn btn-success" ng-click="$ctrl.addName(language)" type="button">
                                 <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                             </button>
                         </span>
                     </div>
                </div>
            </p>
        </div>
        <p>
            <div class="input-group">
                <span class="input-group-btn">
                    <button class="btn btn-success" ng-click="$ctrl.addLanguage()" type="button">
                        <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                    </button>
                </span>
                <input type="text" class="form-control" id="language-input" placeholder="Add language...">
            </div>
        </p>
    </div>

    <div class="row">
        <h4>Subtypes</h4>

        <form class="form-group">
            <div class="row">
                <div class="col-md-12 btn-group-sm">
                    <button class="btn btn-default" ng-click="$ctrl.selectAllSubtypes()">
                        Select all
                    </button>
                    <button class="btn btn-default" ng-click="$ctrl.deselectAllSubtypes()">
                        Deselect all
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6" ng-repeat="subtype in $ctrl.validSubtypes">
                    <input type="checkbox"
                           name="selectedSubtypes"
                           value="{{subtype}}"
                           ng-checked="$ctrl.period.types.indexOf(subtype) > -1"
                           ng-click="$ctrl.toggleSubtypeSelection(subtype)">
                    {{subtype}}
                </div>
            </div>
        </form>
    </div>

    <div class="row">
        <h4>Definition</h4>
        <textarea class="form-control" rows="3" ng-model="$ctrl.period.definition"></textarea>
    </div>

    <div class="row">
        <h4>Description</h4>
        <textarea class="form-control" rows="3" ng-model="$ctrl.period.description"></textarea>
    </div>

    <div class="row">
        <h4>Provenance</h4>
        <form class="form-group">
            <div class="col-md-6" ng-repeat="provenance in $ctrl.validProvenances">
            <label>
                <input type="radio" ng-model="$ctrl.period.provenance" value="{{provenance}}">
                {{provenance}}
            </label>
            </div>
        </form>
    </div>


    <div class="row">
        <h4>Tags</h4>
        <div class="row">
            <div ng-repeat="tag in $ctrl.period.tags track by $index" class="col-md-6">
                <div class="input-group">
                    <span class="input-group-btn">
                         <button class="btn btn-danger"
                                 ng-click="$ctrl.removeTag(tag)"
                                 type="button">
                             <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span>
                         </button>
                    </span>
                    <input type="text"
                           class="form-control"
                           ng-model="$ctrl.period.tags[$index]">
                </div>
            </div>
        </div>
        <p/>
        <div class="row col-md-12">
            <div class="input-group">
                <span class="input-group-btn">
                    <button class="btn btn-success" ng-click="$ctrl.addTag()" type="button">
                        <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                    </button>
                </span>
                <input type="text" class="form-control" id="tag-input" placeholder="Add tag...">
            </div>
        </div>
    </div>

    <div class="row">
        <h4>Note</h4>
        <textarea class="form-control" rows="3" ng-model="$ctrl.period.note"></textarea>
    </div>

    <div class="row">
        <form class="form-group">
            <h4>Ongoing? </h4>
            <input type="checkbox"
                   name="toggleOngoing"
                   value="{{$ctrl.period.ongoing}}"
                   ng-checked="$ctrl.period.ongoing"
                   ng-click="$ctrl.period.ongoing = !$ctrl.period.ongoing">
        </form>
    </div>

    <!-- TODO: period.hasTimespan -->

    <div class="row form-group">
        <h4>Relations</h4>

        <div class="col-md-12" ng-init="relationIndex = $index"
             ng-repeat="(relationName, values) in $ctrl.period.relations">
            <div ng-if="relationName!='derived'">
                <div>{{relationName}}</div>
                <div class="col-md-4"
                     ng-init="valueIndex = $index"
                     ng-repeat="value in values track by $index">
                    <span class="input-group">
                        <input type="text"
                               class="form-control"
                               ng-model="$ctrl.period.relations[relationName][valueIndex]">
                        <span class="input-group-btn">
                                 <button class="btn btn-danger"
                                         ng-click="$ctrl.removeRelation(relationName, value)"
                                         type="button">
                                     <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span>
                                 </button>
                            </span>
                    </span>
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                        <input type="text" class="form-control" id="relation-input-{{relationName}}" placeholder="Add relation...">
                        <span class="input-group-btn">
                                 <button class="btn btn-success" ng-click="$ctrl.addRelation(relationName)" type="button">
                                     <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                                 </button>
                             </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <p>
        <div class="row">
            <button class="btn btn-primary" ng-click="$ctrl.saveChanges()">Save changes</button>
            <button class="btn btn-default" ng-click="$ctrl.reset()">Reset changes</button>
        </div>
    </p>
</div>
